{"ast":null,"code":"import Reflux from 'reflux';\nimport axios from 'axios';\nimport LoggedUserActions from '../actions/LoggedUser';\nimport GlobalRedirectActions from '../actions/GlobalRedirect';\n\nclass LoggedUserStore extends Reflux.Store {\n  constructor() {\n    console.log(\"STORE\");\n    super();\n    this.state = {\n      token: localStorage.getItem('token') || '',\n      logged: false,\n      username: undefined\n    };\n    this.listenTo(LoggedUserActions.login, this.login);\n    this.listenTo(LoggedUserActions.signup, this.signup);\n    this.listenTo(LoggedUserActions.tokenAuthenticate, this.tokenAuthenticate);\n    this.listenTo(LoggedUserActions.logout, this.logout);\n    this.tokenAuthenticate();\n  }\n\n  tokenAuthenticate() {\n    if (localStorage.getItem('token') !== undefined) {\n      console.log(\"Authenticating...\");\n      axios.get('http://localhost:8000/core/current_user/', {\n        headers: {\n          Authorization: `JWT ${localStorage.getItem('token')}`\n        }\n      }).then(res => {\n        console.log(res);\n        res = res.data;\n        this.setState(prevState => {\n          return { ...prevState,\n            logged: true,\n            username: res.username\n          };\n        });\n      });\n    }\n  }\n\n  login(user) {\n    axios.post('http://localhost:8000/token-auth/', JSON.stringify({\n      username: user.username,\n      password: user.password\n    }), {\n      headers: {\n        \"Content-Type\": \"application/json\"\n      }\n    }).then(res => {\n      console.log(user.username);\n      console.log(res);\n      res = res.data;\n      this.setState({\n        logged: true,\n        username: user.username,\n        token: res.token\n      });\n      localStorage.setItem('token', res.token);\n      GlobalRedirectActions.redirect('/');\n    }).catch(err => {\n      console.log(err);\n    });\n  }\n\n  signup(user) {\n    axios.post('http://localhost:8000/core/users/', JSON.stringify({\n      username: user.username,\n      password: user.password\n    }), {\n      headers: {\n        \"Content-Type\": \"application/json\"\n      }\n    }).then(res => {\n      res = res.data;\n      this.setState({\n        logged: true,\n        username: user.username,\n        token: res.token\n      });\n      localStorage.setItem('token', res.token);\n      GlobalRedirectActions.redirect('/');\n    }).catch(err => {\n      console.log(err);\n    });\n  }\n\n  logout() {\n    this.setState(prevState => {\n      return { ...prevState,\n        token: '',\n        logged: false,\n        username: undefined\n      };\n    });\n    localStorage.removeItem('token');\n  }\n\n}\n\nexport default LoggedUserStore;","map":{"version":3,"sources":["/home/tudor/work/sd/assignment-3-Lolkekzor/project/frontend/src/reflux/stores/LoggedUser.js"],"names":["Reflux","axios","LoggedUserActions","GlobalRedirectActions","LoggedUserStore","Store","constructor","console","log","state","token","localStorage","getItem","logged","username","undefined","listenTo","login","signup","tokenAuthenticate","logout","get","headers","Authorization","then","res","data","setState","prevState","user","post","JSON","stringify","password","setItem","redirect","catch","err","removeItem"],"mappings":"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","sourcesContent":["import Reflux from 'reflux';\nimport axios from 'axios';\n\nimport LoggedUserActions from '../actions/LoggedUser';\nimport GlobalRedirectActions from '../actions/GlobalRedirect';\n\nclass LoggedUserStore extends Reflux.Store {\n    constructor() {\n        console.log(\"STORE\");\n        super();\n        this.state = {\n            token: localStorage.getItem('token') || '',\n            logged: false,\n            username: undefined\n        }\n\n        this.listenTo(LoggedUserActions.login, this.login);\n        this.listenTo(LoggedUserActions.signup, this.signup);\n        this.listenTo(LoggedUserActions.tokenAuthenticate, this.tokenAuthenticate);\n        this.listenTo(LoggedUserActions.logout, this.logout);\n\n        this.tokenAuthenticate();\n    }\n\n    tokenAuthenticate() {\n        if (localStorage.getItem('token') !== undefined) {\n            console.log(\"Authenticating...\");\n            axios.get('http://localhost:8000/core/current_user/', {\n                headers: {\n                    Authorization: `JWT ${localStorage.getItem('token')}`\n                }\n            }).then(res => {\n                console.log(res);\n                res = res.data;\n                this.setState(prevState => {\n                    return {\n                        ...prevState,\n                        logged: true,\n                        username: res.username\n                    }\n                })\n            })\n        }\n    }\n\n    login(user) {\n        axios.post('http://localhost:8000/token-auth/', JSON.stringify({\n            username: user.username,\n            password: user.password\n        }), {\n            headers: {\"Content-Type\": \"application/json\"}\n        }).then(res => {\n            console.log(user.username);\n            console.log(res);\n            res = res.data;\n            this.setState({\n                logged: true,\n                username: user.username,\n                token: res.token\n            })\n            localStorage.setItem('token', res.token);\n            GlobalRedirectActions.redirect('/');\n        }).catch(err => {\n            console.log(err);\n        })\n    }\n    \n    signup(user) {\n        axios.post('http://localhost:8000/core/users/', JSON.stringify({\n            username: user.username,\n            password: user.password\n        }), {\n            headers: {\"Content-Type\": \"application/json\"}\n        }).then(res => {\n            res = res.data;\n            this.setState({\n                logged: true,\n                username: user.username,\n                token: res.token\n            })\n            localStorage.setItem('token', res.token);\n            GlobalRedirectActions.redirect('/');\n        }).catch(err => {\n            console.log(err);\n        })\n    }\n\n    logout() {\n        this.setState(prevState => {\n            return {\n                ...prevState,\n                token: '',\n                logged: false,\n                username: undefined\n            }\n        });\n        localStorage.removeItem('token');\n    }\n}\n\nexport default LoggedUserStore;\n"]},"metadata":{},"sourceType":"module"}