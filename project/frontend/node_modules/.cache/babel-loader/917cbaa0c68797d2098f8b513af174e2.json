{"ast":null,"code":"import Reflux from 'reflux';\nimport axios from 'axios';\nimport LoggedUserActions from '../actions/LoggedUser';\nimport GlobalRedirectActions from '../actions/GlobalRedirect';\n\nclass LoggedUserStore extends Reflux.Store {\n  constructor() {\n    super();\n    this.state = {\n      token: localStorage.getItem('token') || '',\n      logged: false,\n      username: ''\n    };\n    this.listenTo(LoggedUserActions.login, this.login);\n  }\n\n  login(user) {\n    if (this.state.token === '') {\n      axios.post('http://localhost:8000/token-auth/', JSON.stringify({\n        username: user.username,\n        password: user.password\n      }), {\n        headers: {\n          \"Content-Type\": \"application/json\"\n        }\n      }).then(res => {\n        console.log(user.username);\n        console.log(res);\n        res = res.data;\n        this.setState({\n          logged: true,\n          username: user.username,\n          token: res.token\n        });\n        localStorage.setItem('token', res.token);\n        GlobalRedirectActions.redirect('/');\n      }).catch(err => {\n        console.log(err);\n      });\n    } else if (!this.state.logged) {\n      axios.get('http://localhost:8000/core/current_user/', {\n        headers: {\n          Authorization: `JWT ${localStorage.getItem('token')}`\n        }\n      }).then(res => {\n        this.setState(prevState => {\n          return { ...prevState,\n            logged: true,\n            username: res.username\n          };\n        });\n      });\n    }\n  }\n\n}\n\nexport default LoggedUserStore;","map":{"version":3,"sources":["/home/tudor/work/sd/project/frontend/src/reflux/stores/LoggedUser.js"],"names":["Reflux","axios","LoggedUserActions","GlobalRedirectActions","LoggedUserStore","Store","constructor","state","token","localStorage","getItem","logged","username","listenTo","login","user","post","JSON","stringify","password","headers","then","res","console","log","data","setState","setItem","redirect","catch","err","get","Authorization","prevState"],"mappings":"AAAA,OAAOA,MAAP,MAAmB,QAAnB;AACA,OAAOC,KAAP,MAAkB,OAAlB;AAEA,OAAOC,iBAAP,MAA8B,uBAA9B;AACA,OAAOC,qBAAP,MAAkC,2BAAlC;;AAEA,MAAMC,eAAN,SAA8BJ,MAAM,CAACK,KAArC,CAA2C;AACvCC,EAAAA,WAAW,GAAG;AACV;AACA,SAAKC,KAAL,GAAa;AACTC,MAAAA,KAAK,EAAEC,YAAY,CAACC,OAAb,CAAqB,OAArB,KAAiC,EAD/B;AAETC,MAAAA,MAAM,EAAE,KAFC;AAGTC,MAAAA,QAAQ,EAAE;AAHD,KAAb;AAOA,SAAKC,QAAL,CAAcX,iBAAiB,CAACY,KAAhC,EAAuC,KAAKA,KAA5C;AACH;;AAEDA,EAAAA,KAAK,CAACC,IAAD,EAAO;AACR,QAAI,KAAKR,KAAL,CAAWC,KAAX,KAAqB,EAAzB,EAA6B;AACzBP,MAAAA,KAAK,CAACe,IAAN,CAAW,mCAAX,EAAgDC,IAAI,CAACC,SAAL,CAAe;AAC3DN,QAAAA,QAAQ,EAAEG,IAAI,CAACH,QAD4C;AAE3DO,QAAAA,QAAQ,EAAEJ,IAAI,CAACI;AAF4C,OAAf,CAAhD,EAGI;AACAC,QAAAA,OAAO,EAAE;AAAC,0BAAgB;AAAjB;AADT,OAHJ,EAKGC,IALH,CAKQC,GAAG,IAAI;AACXC,QAAAA,OAAO,CAACC,GAAR,CAAYT,IAAI,CAACH,QAAjB;AACAW,QAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ;AACAA,QAAAA,GAAG,GAAGA,GAAG,CAACG,IAAV;AACA,aAAKC,QAAL,CAAc;AACVf,UAAAA,MAAM,EAAE,IADE;AAEVC,UAAAA,QAAQ,EAAEG,IAAI,CAACH,QAFL;AAGVJ,UAAAA,KAAK,EAAEc,GAAG,CAACd;AAHD,SAAd;AAKAC,QAAAA,YAAY,CAACkB,OAAb,CAAqB,OAArB,EAA8BL,GAAG,CAACd,KAAlC;AACAL,QAAAA,qBAAqB,CAACyB,QAAtB,CAA+B,GAA/B;AACH,OAhBD,EAgBGC,KAhBH,CAgBSC,GAAG,IAAI;AACZP,QAAAA,OAAO,CAACC,GAAR,CAAYM,GAAZ;AACH,OAlBD;AAmBH,KApBD,MAoBO,IAAI,CAAC,KAAKvB,KAAL,CAAWI,MAAhB,EAAwB;AAC3BV,MAAAA,KAAK,CAAC8B,GAAN,CAAU,0CAAV,EAAsD;AAClDX,QAAAA,OAAO,EAAE;AACLY,UAAAA,aAAa,EAAG,OAAMvB,YAAY,CAACC,OAAb,CAAqB,OAArB,CAA8B;AAD/C;AADyC,OAAtD,EAIGW,IAJH,CAIQC,GAAG,IAAI;AACX,aAAKI,QAAL,CAAcO,SAAS,IAAI;AACvB,iBAAO,EACH,GAAGA,SADA;AAEHtB,YAAAA,MAAM,EAAE,IAFL;AAGHC,YAAAA,QAAQ,EAAEU,GAAG,CAACV;AAHX,WAAP;AAKH,SAND;AAOH,OAZD;AAaH;AACJ;;AAjDsC;;AAoD3C,eAAeR,eAAf","sourcesContent":["import Reflux from 'reflux';\nimport axios from 'axios';\n\nimport LoggedUserActions from '../actions/LoggedUser';\nimport GlobalRedirectActions from '../actions/GlobalRedirect';\n\nclass LoggedUserStore extends Reflux.Store {\n    constructor() {\n        super();\n        this.state = {\n            token: localStorage.getItem('token') || '',\n            logged: false,\n            username: ''\n        }\n\n\n        this.listenTo(LoggedUserActions.login, this.login);\n    }\n\n    login(user) {\n        if (this.state.token === '') {\n            axios.post('http://localhost:8000/token-auth/', JSON.stringify({\n                username: user.username,\n                password: user.password\n            }), {\n                headers: {\"Content-Type\": \"application/json\"}\n            }).then(res => {\n                console.log(user.username);\n                console.log(res);\n                res = res.data;\n                this.setState({\n                    logged: true,\n                    username: user.username,\n                    token: res.token\n                })\n                localStorage.setItem('token', res.token);\n                GlobalRedirectActions.redirect('/');\n            }).catch(err => {\n                console.log(err);\n            })\n        } else if (!this.state.logged) {\n            axios.get('http://localhost:8000/core/current_user/', {\n                headers: {\n                    Authorization: `JWT ${localStorage.getItem('token')}`\n                }\n            }).then(res => {\n                this.setState(prevState => {\n                    return {\n                        ...prevState,\n                        logged: true,\n                        username: res.username\n                    }\n                })\n            })\n        }\n    }\n}\n\nexport default LoggedUserStore;\n"]},"metadata":{},"sourceType":"module"}